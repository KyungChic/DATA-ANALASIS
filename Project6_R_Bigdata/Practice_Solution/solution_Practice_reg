<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
# Slide 91

titanic<-read.csv(file="DataSet/titanic.csv") 
str(titanic)

# (1)

titanic %>% filter(pclass == '1st') %>% summarize(survival = mean(survived))

# (2)
titanic %>% group_by(pclass) %>% summarize(survival = mean(survived))

# (3)

n1<-titanic %>% filter(age >=20, pclass == '1st') %>% summarize(n = n())
n2<-titanic %>% filter(!is.na(age), pclass == '1st') %>% summarize(n = n())

n1/n2

#(4)

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    filter(!is.na(age)) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))




## -------------------------------------------------------
# Slide 100~ 


admissions<-read.csv("DataSet/admissions.csv")
str(admissions)

# admissions<-admissions %>% mutate(ADMDATE2 = as.Date(admissions$ADMDATE) )

admissions$ADMDATE2<-as.Date(admissions$ADMDATE)
head(admissions, n=3)


## -------------------------------------------------------

admissions %>% filter(HOSP ==3) %>% summarize(freq=n())

## -------------------------------------------------------

admissions %>% 
    mutate(Group = ifelse(substr(PRIMDX, 1, 3) == '410', 'MI', 
                          ifelse(substr(PRIMDX, 1, 3) =='428','CHF', 'Others'))) %>% 
    group_by(Group) %>% 
    summarize(n=n())

## -----------------------------------------------------

admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    filter(Period >=14) %>% select(PT_ID, ADMDATE, DISDATE, Period, HOSP) 


## -------------------------------------------------------
admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    group_by(PT_ID) %>% summarize(nstay=n(), min_stay=min(Period), max_stay=max(Period))


## ---------------------------------------
hospital<-read.csv("DataSet/hospital.csv")

admissions %>% filter(HOSP %in% c(2,4)) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


hosp_list<-hospital %>% filter(hospname %in% c('Our Lady of Charity', 'Community Hospital'))
admissions %>% filter(HOSP %in% hosp_list$hosp_id) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


## ---------------------------------------

table(admissions$HOSP)
table(hospital$hosp_id)

tb<-admissions %>% rename(hosp_id = HOSP) %>% group_by(hosp_id) %>% summarize(Freq=n()) 

left_join(hospital, tb, by="hosp_id")



## ---------------------------------------
## ---------------------------------------

# Slide 155
hsb2<-read.table("DataSet/hsb2.txt", header=T, sep="\t")
hsb2$gender<-factor(hsb2$female, labels=c('male', 'female'))
hsb2$ses2<-factor(hsb2$ses, labels=c('low', 'middle', 'high'))
hsb2$prog2<-factor(hsb2$prog, labels=c('general', 'academic', 'vocational'))
hsb2$race2<-factor(hsb2$race, labels=c('AfricanAmerican', 'Asian', 'Hispanic', 'White'))
hsb2$schtyp2<-factor(hsb2$schtyp, labels=c('public', 'private'))
head(hsb2)

hsb2_cat <- hsb2 %>% select(gender, ses2, prog2, race2, schtyp2)
lapply(hsb2_cat, table) 

# Slide 156
# (1) 
hsb2new2<-hsb2new %>% select(read:socst) # 수치형 변수만 포함 
cor(hsb2new2)
ggcorrplot::ggcorrplot(cor(hsb2new2), hc.order=T, type='lower', lab=T)
GGally::ggpairs(hsb2new2)

# (2)
hsb2new<-hsb2 %>% select(read:socst, gender, race2) # 회귀식 변수만 포함 
reg1<-lm(science ~ ., data=hsb2new)
summary(reg1)
# stepwise selection 
reg.step<-step(reg1, direction = "both")

(f<-formula(reg.step))

vif(reg.step) # 다중공선성 문제 없는 것을 확인 
summary(reg.step)

idx<-which(abs(stdres(reg.step))>2.5)
idx

hsb2new3<-hsb2new[-idx, ]
newreg<-lm(f, data=hsb2new3)
summary(newreg)

#------------------------------------------------
# (참고)
dat<-hsb2
names(dat)
dat$white<-as.factor(ifelse(dat$race == 4, 1, 0))
str(dat)
names(dat)
dat2<-dat %>% select(gender, white, read:science)
names(dat2)
newreg2<-lm(science ~ ., data=dat2)
summary(newreg2)








=======
# Slide 91

titanic<-read.csv(file="DataSet/titanic.csv") 
str(titanic)

# (1)

titanic %>% filter(pclass == '1st') %>% summarize(survival = mean(survived))

# (2)
titanic %>% group_by(pclass) %>% summarize(survival = mean(survived))

# (3)

n1<-titanic %>% filter(age >=20, pclass == '1st') %>% summarize(n = n())
n2<-titanic %>% filter(!is.na(age), pclass == '1st') %>% summarize(n = n())

n1/n2

#(4)

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    filter(!is.na(age)) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))




## -------------------------------------------------------
# Slide 100~ 


admissions<-read.csv("DataSet/admissions.csv")
str(admissions)

# admissions<-admissions %>% mutate(ADMDATE2 = as.Date(admissions$ADMDATE) )

admissions$ADMDATE2<-as.Date(admissions$ADMDATE)
head(admissions, n=3)


## -------------------------------------------------------

admissions %>% filter(HOSP ==3) %>% summarize(freq=n())

## -------------------------------------------------------

admissions %>% 
    mutate(Group = ifelse(substr(PRIMDX, 1, 3) == '410', 'MI', 
                          ifelse(substr(PRIMDX, 1, 3) =='428','CHF', 'Others'))) %>% 
    group_by(Group) %>% 
    summarize(n=n())

## -----------------------------------------------------

admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    filter(Period >=14) %>% select(PT_ID, ADMDATE, DISDATE, Period, HOSP) 


## -------------------------------------------------------
admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    group_by(PT_ID) %>% summarize(nstay=n(), min_stay=min(Period), max_stay=max(Period))


## ---------------------------------------
hospital<-read.csv("DataSet/hospital.csv")

admissions %>% filter(HOSP %in% c(2,4)) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


hosp_list<-hospital %>% filter(hospname %in% c('Our Lady of Charity', 'Community Hospital'))
admissions %>% filter(HOSP %in% hosp_list$hosp_id) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


## ---------------------------------------

table(admissions$HOSP)
table(hospital$hosp_id)

tb<-admissions %>% rename(hosp_id = HOSP) %>% group_by(hosp_id) %>% summarize(Freq=n()) 

left_join(hospital, tb, by="hosp_id")



## ---------------------------------------
## ---------------------------------------

# Slide 155
hsb2<-read.table("DataSet/hsb2.txt", header=T, sep="\t")
hsb2$gender<-factor(hsb2$female, labels=c('male', 'female'))
hsb2$ses2<-factor(hsb2$ses, labels=c('low', 'middle', 'high'))
hsb2$prog2<-factor(hsb2$prog, labels=c('general', 'academic', 'vocational'))
hsb2$race2<-factor(hsb2$race, labels=c('AfricanAmerican', 'Asian', 'Hispanic', 'White'))
hsb2$schtyp2<-factor(hsb2$schtyp, labels=c('public', 'private'))
head(hsb2)

hsb2_cat <- hsb2 %>% select(gender, ses2, prog2, race2, schtyp2)
lapply(hsb2_cat, table) 

# Slide 156
# (1) 
hsb2new2<-hsb2new %>% select(read:socst) # 수치형 변수만 포함 
cor(hsb2new2)
ggcorrplot::ggcorrplot(cor(hsb2new2), hc.order=T, type='lower', lab=T)
GGally::ggpairs(hsb2new2)

# (2)
hsb2new<-hsb2 %>% select(read:socst, gender, race2) # 회귀식 변수만 포함 
reg1<-lm(science ~ ., data=hsb2new)
summary(reg1)
# stepwise selection 
reg.step<-step(reg1, direction = "both")

(f<-formula(reg.step))

vif(reg.step) # 다중공선성 문제 없는 것을 확인 
summary(reg.step)

idx<-which(abs(stdres(reg.step))>2.5)
idx

hsb2new3<-hsb2new[-idx, ]
newreg<-lm(f, data=hsb2new3)
summary(newreg)

#------------------------------------------------
# (참고)
dat<-hsb2
names(dat)
dat$white<-as.factor(ifelse(dat$race == 4, 1, 0))
str(dat)
names(dat)
dat2<-dat %>% select(gender, white, read:science)
names(dat2)
newreg2<-lm(science ~ ., data=dat2)
summary(newreg2)








>>>>>>> 5c5a7e65ae3a3edf20e3212427f4d26207c4addc
=======
# Slide 91

titanic<-read.csv(file="DataSet/titanic.csv") 
str(titanic)

# (1)

titanic %>% filter(pclass == '1st') %>% summarize(survival = mean(survived))

# (2)
titanic %>% group_by(pclass) %>% summarize(survival = mean(survived))

# (3)

n1<-titanic %>% filter(age >=20, pclass == '1st') %>% summarize(n = n())
n2<-titanic %>% filter(!is.na(age), pclass == '1st') %>% summarize(n = n())

n1/n2

#(4)

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    filter(!is.na(age)) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))




## -------------------------------------------------------
# Slide 100~ 


admissions<-read.csv("DataSet/admissions.csv")
str(admissions)

# admissions<-admissions %>% mutate(ADMDATE2 = as.Date(admissions$ADMDATE) )

admissions$ADMDATE2<-as.Date(admissions$ADMDATE)
head(admissions, n=3)


## -------------------------------------------------------

admissions %>% filter(HOSP ==3) %>% summarize(freq=n())

## -------------------------------------------------------

admissions %>% 
    mutate(Group = ifelse(substr(PRIMDX, 1, 3) == '410', 'MI', 
                          ifelse(substr(PRIMDX, 1, 3) =='428','CHF', 'Others'))) %>% 
    group_by(Group) %>% 
    summarize(n=n())

## -----------------------------------------------------

admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    filter(Period >=14) %>% select(PT_ID, ADMDATE, DISDATE, Period, HOSP) 


## -------------------------------------------------------
admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    group_by(PT_ID) %>% summarize(nstay=n(), min_stay=min(Period), max_stay=max(Period))


## ---------------------------------------
hospital<-read.csv("DataSet/hospital.csv")

admissions %>% filter(HOSP %in% c(2,4)) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


hosp_list<-hospital %>% filter(hospname %in% c('Our Lady of Charity', 'Community Hospital'))
admissions %>% filter(HOSP %in% hosp_list$hosp_id) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


## ---------------------------------------

table(admissions$HOSP)
table(hospital$hosp_id)

tb<-admissions %>% rename(hosp_id = HOSP) %>% group_by(hosp_id) %>% summarize(Freq=n()) 

left_join(hospital, tb, by="hosp_id")



## ---------------------------------------
## ---------------------------------------

# Slide 155
hsb2<-read.table("DataSet/hsb2.txt", header=T, sep="\t")
hsb2$gender<-factor(hsb2$female, labels=c('male', 'female'))
hsb2$ses2<-factor(hsb2$ses, labels=c('low', 'middle', 'high'))
hsb2$prog2<-factor(hsb2$prog, labels=c('general', 'academic', 'vocational'))
hsb2$race2<-factor(hsb2$race, labels=c('AfricanAmerican', 'Asian', 'Hispanic', 'White'))
hsb2$schtyp2<-factor(hsb2$schtyp, labels=c('public', 'private'))
head(hsb2)

hsb2_cat <- hsb2 %>% select(gender, ses2, prog2, race2, schtyp2)
lapply(hsb2_cat, table) 

# Slide 156
# (1) 
hsb2new2<-hsb2new %>% select(read:socst) # 수치형 변수만 포함 
cor(hsb2new2)
ggcorrplot::ggcorrplot(cor(hsb2new2), hc.order=T, type='lower', lab=T)
GGally::ggpairs(hsb2new2)

# (2)
hsb2new<-hsb2 %>% select(read:socst, gender, race2) # 회귀식 변수만 포함 
reg1<-lm(science ~ ., data=hsb2new)
summary(reg1)
# stepwise selection 
reg.step<-step(reg1, direction = "both")

(f<-formula(reg.step))

vif(reg.step) # 다중공선성 문제 없는 것을 확인 
summary(reg.step)

idx<-which(abs(stdres(reg.step))>2.5)
idx

hsb2new3<-hsb2new[-idx, ]
newreg<-lm(f, data=hsb2new3)
summary(newreg)

#------------------------------------------------
# (참고)
dat<-hsb2
names(dat)
dat$white<-as.factor(ifelse(dat$race == 4, 1, 0))
str(dat)
names(dat)
dat2<-dat %>% select(gender, white, read:science)
names(dat2)
newreg2<-lm(science ~ ., data=dat2)
summary(newreg2)








>>>>>>> 5c5a7e65ae3a3edf20e3212427f4d26207c4addc
=======
# Slide 91

titanic<-read.csv(file="DataSet/titanic.csv") 
str(titanic)

# (1)

titanic %>% filter(pclass == '1st') %>% summarize(survival = mean(survived))

# (2)
titanic %>% group_by(pclass) %>% summarize(survival = mean(survived))

# (3)

n1<-titanic %>% filter(age >=20, pclass == '1st') %>% summarize(n = n())
n2<-titanic %>% filter(!is.na(age), pclass == '1st') %>% summarize(n = n())

n1/n2

#(4)

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    filter(!is.na(age)) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))




## -------------------------------------------------------
# Slide 100~ 


admissions<-read.csv("DataSet/admissions.csv")
str(admissions)

# admissions<-admissions %>% mutate(ADMDATE2 = as.Date(admissions$ADMDATE) )

admissions$ADMDATE2<-as.Date(admissions$ADMDATE)
head(admissions, n=3)


## -------------------------------------------------------

admissions %>% filter(HOSP ==3) %>% summarize(freq=n())

## -------------------------------------------------------

admissions %>% 
    mutate(Group = ifelse(substr(PRIMDX, 1, 3) == '410', 'MI', 
                          ifelse(substr(PRIMDX, 1, 3) =='428','CHF', 'Others'))) %>% 
    group_by(Group) %>% 
    summarize(n=n())

## -----------------------------------------------------

admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    filter(Period >=14) %>% select(PT_ID, ADMDATE, DISDATE, Period, HOSP) 


## -------------------------------------------------------
admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    group_by(PT_ID) %>% summarize(nstay=n(), min_stay=min(Period), max_stay=max(Period))


## ---------------------------------------
hospital<-read.csv("DataSet/hospital.csv")

admissions %>% filter(HOSP %in% c(2,4)) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


hosp_list<-hospital %>% filter(hospname %in% c('Our Lady of Charity', 'Community Hospital'))
admissions %>% filter(HOSP %in% hosp_list$hosp_id) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


## ---------------------------------------

table(admissions$HOSP)
table(hospital$hosp_id)

tb<-admissions %>% rename(hosp_id = HOSP) %>% group_by(hosp_id) %>% summarize(Freq=n()) 

left_join(hospital, tb, by="hosp_id")



## ---------------------------------------
## ---------------------------------------

# Slide 155
hsb2<-read.table("DataSet/hsb2.txt", header=T, sep="\t")
hsb2$gender<-factor(hsb2$female, labels=c('male', 'female'))
hsb2$ses2<-factor(hsb2$ses, labels=c('low', 'middle', 'high'))
hsb2$prog2<-factor(hsb2$prog, labels=c('general', 'academic', 'vocational'))
hsb2$race2<-factor(hsb2$race, labels=c('AfricanAmerican', 'Asian', 'Hispanic', 'White'))
hsb2$schtyp2<-factor(hsb2$schtyp, labels=c('public', 'private'))
head(hsb2)

hsb2_cat <- hsb2 %>% select(gender, ses2, prog2, race2, schtyp2)
lapply(hsb2_cat, table) 

# Slide 156
# (1) 
hsb2new2<-hsb2new %>% select(read:socst) # 수치형 변수만 포함 
cor(hsb2new2)
ggcorrplot::ggcorrplot(cor(hsb2new2), hc.order=T, type='lower', lab=T)
GGally::ggpairs(hsb2new2)

# (2)
hsb2new<-hsb2 %>% select(read:socst, gender, race2) # 회귀식 변수만 포함 
reg1<-lm(science ~ ., data=hsb2new)
summary(reg1)
# stepwise selection 
reg.step<-step(reg1, direction = "both")

(f<-formula(reg.step))

vif(reg.step) # 다중공선성 문제 없는 것을 확인 
summary(reg.step)

idx<-which(abs(stdres(reg.step))>2.5)
idx

hsb2new3<-hsb2new[-idx, ]
newreg<-lm(f, data=hsb2new3)
summary(newreg)

#------------------------------------------------
# (참고)
dat<-hsb2
names(dat)
dat$white<-as.factor(ifelse(dat$race == 4, 1, 0))
str(dat)
names(dat)
dat2<-dat %>% select(gender, white, read:science)
names(dat2)
newreg2<-lm(science ~ ., data=dat2)
summary(newreg2)








>>>>>>> 5c5a7e65ae3a3edf20e3212427f4d26207c4addc
=======
# Slide 91

titanic<-read.csv(file="DataSet/titanic.csv") 
str(titanic)

# (1)

titanic %>% filter(pclass == '1st') %>% summarize(survival = mean(survived))

# (2)
titanic %>% group_by(pclass) %>% summarize(survival = mean(survived))

# (3)

n1<-titanic %>% filter(age >=20, pclass == '1st') %>% summarize(n = n())
n2<-titanic %>% filter(!is.na(age), pclass == '1st') %>% summarize(n = n())

n1/n2

#(4)

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    filter(!is.na(age)) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))




## -------------------------------------------------------
# Slide 100~ 


admissions<-read.csv("DataSet/admissions.csv")
str(admissions)

# admissions<-admissions %>% mutate(ADMDATE2 = as.Date(admissions$ADMDATE) )

admissions$ADMDATE2<-as.Date(admissions$ADMDATE)
head(admissions, n=3)


## -------------------------------------------------------

admissions %>% filter(HOSP ==3) %>% summarize(freq=n())

## -------------------------------------------------------

admissions %>% 
    mutate(Group = ifelse(substr(PRIMDX, 1, 3) == '410', 'MI', 
                          ifelse(substr(PRIMDX, 1, 3) =='428','CHF', 'Others'))) %>% 
    group_by(Group) %>% 
    summarize(n=n())

## -----------------------------------------------------

admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    filter(Period >=14) %>% select(PT_ID, ADMDATE, DISDATE, Period, HOSP) 


## -------------------------------------------------------
admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    group_by(PT_ID) %>% summarize(nstay=n(), min_stay=min(Period), max_stay=max(Period))


## ---------------------------------------
hospital<-read.csv("DataSet/hospital.csv")

admissions %>% filter(HOSP %in% c(2,4)) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


hosp_list<-hospital %>% filter(hospname %in% c('Our Lady of Charity', 'Community Hospital'))
admissions %>% filter(HOSP %in% hosp_list$hosp_id) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


## ---------------------------------------

table(admissions$HOSP)
table(hospital$hosp_id)

tb<-admissions %>% rename(hosp_id = HOSP) %>% group_by(hosp_id) %>% summarize(Freq=n()) 

left_join(hospital, tb, by="hosp_id")



## ---------------------------------------
## ---------------------------------------

# Slide 155
hsb2<-read.table("DataSet/hsb2.txt", header=T, sep="\t")
hsb2$gender<-factor(hsb2$female, labels=c('male', 'female'))
hsb2$ses2<-factor(hsb2$ses, labels=c('low', 'middle', 'high'))
hsb2$prog2<-factor(hsb2$prog, labels=c('general', 'academic', 'vocational'))
hsb2$race2<-factor(hsb2$race, labels=c('AfricanAmerican', 'Asian', 'Hispanic', 'White'))
hsb2$schtyp2<-factor(hsb2$schtyp, labels=c('public', 'private'))
head(hsb2)

hsb2_cat <- hsb2 %>% select(gender, ses2, prog2, race2, schtyp2)
lapply(hsb2_cat, table) 

# Slide 156
# (1) 
hsb2new2<-hsb2new %>% select(read:socst) # 수치형 변수만 포함 
cor(hsb2new2)
ggcorrplot::ggcorrplot(cor(hsb2new2), hc.order=T, type='lower', lab=T)
GGally::ggpairs(hsb2new2)

# (2)
hsb2new<-hsb2 %>% select(read:socst, gender, race2) # 회귀식 변수만 포함 
reg1<-lm(science ~ ., data=hsb2new)
summary(reg1)
# stepwise selection 
reg.step<-step(reg1, direction = "both")

(f<-formula(reg.step))

vif(reg.step) # 다중공선성 문제 없는 것을 확인 
summary(reg.step)

idx<-which(abs(stdres(reg.step))>2.5)
idx

hsb2new3<-hsb2new[-idx, ]
newreg<-lm(f, data=hsb2new3)
summary(newreg)

#------------------------------------------------
# (참고)
dat<-hsb2
names(dat)
dat$white<-as.factor(ifelse(dat$race == 4, 1, 0))
str(dat)
names(dat)
dat2<-dat %>% select(gender, white, read:science)
names(dat2)
newreg2<-lm(science ~ ., data=dat2)
summary(newreg2)








>>>>>>> 5c5a7e65ae3a3edf20e3212427f4d26207c4addc
=======
# Slide 91

titanic<-read.csv(file="DataSet/titanic.csv") 
str(titanic)

# (1)

titanic %>% filter(pclass == '1st') %>% summarize(survival = mean(survived))

# (2)
titanic %>% group_by(pclass) %>% summarize(survival = mean(survived))

# (3)

n1<-titanic %>% filter(age >=20, pclass == '1st') %>% summarize(n = n())
n2<-titanic %>% filter(!is.na(age), pclass == '1st') %>% summarize(n = n())

n1/n2

#(4)

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))

titanic %>% mutate(AgeGroup = ifelse(age >=18, 'Adult', 'Child')) %>% 
    filter(!is.na(age)) %>% 
    group_by(sex, pclass, AgeGroup) %>% 
    summarize(survival = mean(survived))




## -------------------------------------------------------
# Slide 100~ 


admissions<-read.csv("DataSet/admissions.csv")
str(admissions)

# admissions<-admissions %>% mutate(ADMDATE2 = as.Date(admissions$ADMDATE) )

admissions$ADMDATE2<-as.Date(admissions$ADMDATE)
head(admissions, n=3)


## -------------------------------------------------------

admissions %>% filter(HOSP ==3) %>% summarize(freq=n())

## -------------------------------------------------------

admissions %>% 
    mutate(Group = ifelse(substr(PRIMDX, 1, 3) == '410', 'MI', 
                          ifelse(substr(PRIMDX, 1, 3) =='428','CHF', 'Others'))) %>% 
    group_by(Group) %>% 
    summarize(n=n())

## -----------------------------------------------------

admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    filter(Period >=14) %>% select(PT_ID, ADMDATE, DISDATE, Period, HOSP) 


## -------------------------------------------------------
admissions %>% mutate(DISDATE2= as.Date(DISDATE), Period = DISDATE2 - ADMDATE2 + 1) %>% 
    group_by(PT_ID) %>% summarize(nstay=n(), min_stay=min(Period), max_stay=max(Period))


## ---------------------------------------
hospital<-read.csv("DataSet/hospital.csv")

admissions %>% filter(HOSP %in% c(2,4)) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


hosp_list<-hospital %>% filter(hospname %in% c('Our Lady of Charity', 'Community Hospital'))
admissions %>% filter(HOSP %in% hosp_list$hosp_id) %>% select(PT_ID, ADMDATE, DISDATE, HOSP) 


## ---------------------------------------

table(admissions$HOSP)
table(hospital$hosp_id)

tb<-admissions %>% rename(hosp_id = HOSP) %>% group_by(hosp_id) %>% summarize(Freq=n()) 

left_join(hospital, tb, by="hosp_id")



## ---------------------------------------
## ---------------------------------------

# Slide 155
hsb2<-read.table("DataSet/hsb2.txt", header=T, sep="\t")
hsb2$gender<-factor(hsb2$female, labels=c('male', 'female'))
hsb2$ses2<-factor(hsb2$ses, labels=c('low', 'middle', 'high'))
hsb2$prog2<-factor(hsb2$prog, labels=c('general', 'academic', 'vocational'))
hsb2$race2<-factor(hsb2$race, labels=c('AfricanAmerican', 'Asian', 'Hispanic', 'White'))
hsb2$schtyp2<-factor(hsb2$schtyp, labels=c('public', 'private'))
head(hsb2)

hsb2_cat <- hsb2 %>% select(gender, ses2, prog2, race2, schtyp2)
lapply(hsb2_cat, table) 

# Slide 156
# (1) 
hsb2new2<-hsb2new %>% select(read:socst) # 수치형 변수만 포함 
cor(hsb2new2)
ggcorrplot::ggcorrplot(cor(hsb2new2), hc.order=T, type='lower', lab=T)
GGally::ggpairs(hsb2new2)

# (2)
hsb2new<-hsb2 %>% select(read:socst, gender, race2) # 회귀식 변수만 포함 
reg1<-lm(science ~ ., data=hsb2new)
summary(reg1)
# stepwise selection 
reg.step<-step(reg1, direction = "both")

(f<-formula(reg.step))

vif(reg.step) # 다중공선성 문제 없는 것을 확인 
summary(reg.step)

idx<-which(abs(stdres(reg.step))>2.5)
idx

hsb2new3<-hsb2new[-idx, ]
newreg<-lm(f, data=hsb2new3)
summary(newreg)

#------------------------------------------------
# (참고)
dat<-hsb2
names(dat)
dat$white<-as.factor(ifelse(dat$race == 4, 1, 0))
str(dat)
names(dat)
dat2<-dat %>% select(gender, white, read:science)
names(dat2)
newreg2<-lm(science ~ ., data=dat2)
summary(newreg2)








>>>>>>> 5c5a7e65ae3a3edf20e3212427f4d26207c4addc
